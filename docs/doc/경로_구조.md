# 표준 경로 구조 (Standard Path Structure)

## 1. 개요 (Overview)

프로젝트의 **재현성(reproducibility)**과 **일관성(consistency)**을 보장하기 위한 표준 경로 구조입니다.

## 2. Docker 볼륨 마운트 (Volume Mounts)

### 2.1. docker-compose.yml 설정

```yaml
services:
  nanococoa-aiserver:
    volumes:
      # 업로드 파일 (입력)
      - ./nanoCocoa_aiserver/static/uploads:/app/static/uploads
      # 결과 파일 (출력)
      - ./nanoCocoa_aiserver/static/results:/app/static/results
      # 로그
      - ./nanoCocoa_aiserver/logs:/app/logs

  nanococoa-mcpserver:
    volumes:
      # AI 서버와 동일한 경로 공유 (읽기 전용)
      - ./nanoCocoa_aiserver/static/uploads:/app/static/uploads:ro
      - ./nanoCocoa_aiserver/static/results:/app/static/results:ro
```

### 2.2. 경로 매핑 (Path Mapping)

| 용도 | 호스트 경로 | 컨테이너 경로 | 권한 |
|------|------------|--------------|------|
| 업로드 | `src/nanoCocoa_aiserver/static/uploads` | `/app/static/uploads` | RW |
| 결과 | `src/nanoCocoa_aiserver/static/results` | `/app/static/results` | RW |
| 로그 | `src/nanoCocoa_aiserver/logs` | `/app/logs` | RW |

## 3. Python 코드에서 사용

### 3.1. 프로젝트 루트 기준 경로 설정

```python
from pathlib import Path

# 프로젝트 루트
project_root = Path(__file__).parent.parent.parent
src_path = project_root / "src"

# Docker 볼륨 마운트 경로
DOCKER_UPLOADS_DIR = src_path / "nanoCocoa_aiserver" / "static" / "uploads"
DOCKER_RESULTS_DIR = src_path / "nanoCocoa_aiserver" / "static" / "results"

# 디렉토리 생성 (없으면)
DOCKER_UPLOADS_DIR.mkdir(parents=True, exist_ok=True)
DOCKER_RESULTS_DIR.mkdir(parents=True, exist_ok=True)
```

### 3.2. Jupyter Notebook에서 사용

```python
# script/김명환/test_llm_mcp.ipynb

import sys
from pathlib import Path

# 프로젝트 루트 경로 설정
project_root = Path.cwd().parent.parent
src_path = project_root / "src"

# Docker 볼륨 마운트 경로
DOCKER_UPLOADS_DIR = src_path / "nanoCocoa_aiserver" / "static" / "uploads"
DOCKER_RESULTS_DIR = src_path / "nanoCocoa_aiserver" / "static" / "results"

# 테스트 이미지 경로
product_image_path = DOCKER_UPLOADS_DIR / "test_product.png"
output_image_path = DOCKER_RESULTS_DIR / "banana_ad_result.png"
```

## 4. 사용 예제 (Usage Examples)

### 4.1. 이미지 업로드

```python
# 1. 클라이언트 → uploads 폴더에 이미지 저장
import shutil
shutil.copy("원본이미지.png", DOCKER_UPLOADS_DIR / "product.png")

# 2. AI 서버 호출 시 해당 경로 전달
params = {
    "product_image_path": str(DOCKER_UPLOADS_DIR / "product.png"),
    "save_output_path": str(DOCKER_RESULTS_DIR / "ad_result.png")
}
```

### 4.2. 결과 이미지 조회

```python
# results 폴더에서 생성된 이미지 확인
output_path = DOCKER_RESULTS_DIR / "ad_result.png"

if output_path.exists():
    print(f"생성 완료: {output_path}")
    print(f"크기: {output_path.stat().st_size:,} bytes")
else:
    print("이미지 생성 실패")
```

## 5. 주의사항 (Cautions)

### 5.1. ❌ 절대 경로 사용 금지

```python
# ❌ 잘못된 예: 개발 환경 특정 경로
product_image_path = "/home/spai0433/codeit-ai-3team-ad-content/script/김명환/image.png"
```

**문제점:**
- Docker 컨테이너가 해당 경로에 접근 불가
- 다른 개발자 환경에서 재현 불가

### 5.2. ✅ 표준 경로 사용 필수

```python
# ✅ 올바른 예: Docker 볼륨 마운트 경로
product_image_path = DOCKER_UPLOADS_DIR / "test_product.png"
output_image_path = DOCKER_RESULTS_DIR / "banana_ad_result.png"
```

**장점:**
- Docker 컨테이너가 볼륨을 통해 접근 가능
- 모든 개발 환경에서 동일하게 작동 (재현성 보장)

## 6. 디렉토리 구조 (Directory Structure)

```
codeit-ai-3team-ad-content/
├── src/
│   ├── docker-compose.yml          # Docker 설정
│   └── nanoCocoa_aiserver/
│       ├── static/
│       │   ├── uploads/            # 입력 이미지 (RW)
│       │   │   └── test_product.png
│       │   └── results/            # 출력 이미지 (RW)
│       │       └── banana_ad_result.png
│       └── logs/                   # 로그 (RW)
│
├── script/
│   └── 김명환/
│       └── test_llm_mcp.ipynb     # 표준 경로 사용
│
└── examples/
    ├── backend_integration_direct.py
    ├── backend_integration_llm.py
    └── backend_integration_mcp.py
```

## 7. 재현성 체크리스트 (Reproducibility Checklist)

- [ ] `src/nanoCocoa_aiserver/static/uploads` 폴더 존재
- [ ] `src/nanoCocoa_aiserver/static/results` 폴더 존재
- [ ] Docker 컨테이너 실행 시 볼륨 마운트 확인
- [ ] 코드에서 `DOCKER_UPLOADS_DIR`, `DOCKER_RESULTS_DIR` 사용
- [ ] 절대 경로 사용 금지 (개발 환경 특정 경로 제거)

## 8. 트러블슈팅 (Troubleshooting)

### 8.1. 이미지 파일을 찾을 수 없습니다

```
이미지 처리 에러: 파일을 찾을 수 없습니다: /home/spai0433/.../image.png
```

**원인:** 절대 경로 사용으로 Docker 컨테이너가 접근 불가

**해결:**
1. `DOCKER_UPLOADS_DIR` 사용
2. 이미지를 `uploads` 폴더에 복사
3. 해당 경로를 API에 전달

### 8.2. 권한 오류 (Permission Denied)

**원인:** Docker 컨테이너가 root 권한으로 실행되어 파일 소유자가 root

**해결:**
```bash
# uploads, results 폴더 권한 변경
sudo chown -R $USER:$USER src/nanoCocoa_aiserver/static/{uploads,results}
sudo chmod -R 755 src/nanoCocoa_aiserver/static/{uploads,results}
```

## 9. 참고 자료 (References)

- Docker Compose volumes: https://docs.docker.com/compose/compose-file/07-volumes/
- Python pathlib: https://docs.python.org/3/library/pathlib.html
