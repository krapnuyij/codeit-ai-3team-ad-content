# 대시보드 CLIP Score 기능 사용 가이드

## 개요

AI 광고 생성 대시보드에 CLIP Score 평가 기능이 추가되었습니다. 생성된 광고 이미지가 입력 프롬프트와 얼마나 부합하는지 정량적으로 평가할 수 있습니다.

## 위치

대시보드 (`/example_generation`) 하단의 **"📊 CLIP Score 평가"** 패널

## 사용 방법

### 1. 이미지 선택

**옵션 1: 생성된 이미지 사용**
1. "평가할 이미지 선택" 드롭다운에서 선택:
   - `1단계 결과 (배경)`: Step 1에서 생성된 배경 이미지
   - `2단계 결과 (텍스트)`: Step 2에서 생성된 텍스트 에셋
   - `최종 결과`: 최종 합성된 광고 이미지

**옵션 2: 직접 업로드**
1. 드롭다운에서 `직접 업로드...` 선택
2. 파일 선택 버튼으로 이미지 업로드 (PNG, JPEG 등)

### 2. 프롬프트 입력

**방법 1: 수동 입력**
- 텍스트 영역에 이미지를 설명하는 프롬프트 입력
- 한글/영문 모두 가능
- 예시: `사과가 그려져 있고 가격과 판매 장소가 적혀 있는 광고 포스터`

**방법 2: 생성 프롬프트 사용**
1. 🔄 버튼 클릭
2. 광고 생성 시 사용한 배경 프롬프트 + 텍스트 내용 자동 조합

### 3. 모델 선택

- **KoCLIP (한글 프롬프트)**: 한글 프롬프트 사용 시 권장 (기본값)
- **OpenAI CLIP (영문 프롬프트)**: 영문 프롬프트 사용 시 권장

### 4. 계산 실행

"CLIP Score 계산" 버튼 클릭

### 5. 결과 확인

결과 패널에 다음 정보 표시:
- **CLIP Score**: 0.0~1.0 범위의 유사도 점수 (색상으로 등급 표시)
- **사용 모델**: 계산에 사용된 모델 (KoCLIP/OpenAI CLIP)
- **해석**: 점수에 대한 자동 설명
- **점수 가이드**: 점수 범위별 의미

## 점수 해석

| 점수 범위 | 색상 | 의미 |
|-----------|------|------|
| **0.7 이상** | 🟢 녹색 | 매우 높은 일치도 - 광고 생성 성공적 |
| **0.5~0.7** | 🟡 연두색 | 높은 일치도 - 양호 |
| **0.3~0.5** | 🟠 노란색 | 중간 일치도 - 개선 가능 |
| **0.3 미만** | 🔴 빨간색 | 낮은 일치도 - 재생성 권장 |

## 사용 예시

### 예시 1: 최종 결과 평가

```
1. 광고 생성 완료 후
2. 이미지 선택: "최종 결과"
3. 프롬프트: "🔄 생성 프롬프트 사용" 버튼 클릭
4. 모델: "KoCLIP (한글 프롬프트)"
5. "CLIP Score 계산" 클릭
6. 결과: 0.75 (매우 높은 일치도)
```

### 예시 2: 다양한 프롬프트 비교

동일 이미지에 대해 여러 프롬프트를 테스트하여 가장 적합한 설명 찾기:

```
프롬프트 1: "빨간 사과"
→ Score: 0.42

프롬프트 2: "신선한 빨간 사과와 가격표"
→ Score: 0.68

프롬프트 3: "사과가 그려져 있고 가격과 판매 장소가 적혀 있는 광고 포스터"
→ Score: 0.78 (최고 점수)
```

### 예시 3: 외부 이미지 평가

```
1. 이미지 선택: "직접 업로드..."
2. 파일 선택: "apple_ad_sample.png"
3. 프롬프트: "Fresh apple advertisement with price and location"
4. 모델: "OpenAI CLIP (영문 프롬프트)"
5. 계산 실행
```

## 주의사항

### 첫 요청 시 지연

- KoCLIP 또는 OpenAI CLIP 모델 첫 로딩 시 5~10초 소요
- 이후 요청은 즉시 처리 (~1초)

### 프롬프트 언어 선택

- **한글 프롬프트** → KoCLIP 사용 권장
- **영문 프롬프트** → OpenAI CLIP 사용 권장
- 이미지 내 한글 텍스트 포함 시 → KoCLIP 권장

### OCR 한계

CLIP은 이미지의 **의미**를 파악하지만, 정확한 문자 인식은 제한적:
- ✅ "가격표" (시각적 패턴) → 잘 인식
- ❌ "1,000원" (정확한 숫자) → 인식 어려움

## 문제 해결

### 에러: "이미지를 선택해주세요"
→ 드롭다운에서 이미지 선택 또는 업로드 필요

### 에러: "선택한 단계의 이미지가 아직 생성되지 않았습니다"
→ 해당 단계까지 광고 생성 실행 필요

### 에러: "Invalid base64 image"
→ 이미지 파일이 손상되었거나 지원되지 않는 형식. PNG/JPEG 확인

### 에러: "CLIP Score calculation failed"
→ 서버 로그 확인. GPU 메모리 부족 가능성

## 기술 상세

### API 엔드포인트

```http
POST /clip-score
Content-Type: application/json

{
  "image_base64": "iVBORw0KGgoAAAANSUh...",
  "prompt": "사과가 그려져 있고...",
  "model_type": "koclip"
}
```

### 응답 예시

```json
{
  "clip_score": 0.7324,
  "prompt": "사과가 그려져 있고 가격과 판매 장소가 적혀 있는 광고 포스터",
  "model_type": "koclip",
  "interpretation": "매우 높은 일치도 - 이미지가 텍스트 설명과 강하게 부합합니다."
}
```

## 관련 문서

- [CLIP Score API 가이드](./CLIP_Score_API_Guide.md)
- [KoCLIP 업데이트 보고서](./CLIP_Score_KoCLIP_Update.md)
- [구현 보고서](./CLIP_Score_Implementation_Report.md)

---

**업데이트**: 2026-01-23  
**버전**: 1.0
